<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Heart Disease Prediction</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='predict.css') }}"
    />
  </head>
  <body>
    <h1>Heart Disease Prediction System</h1>
    <form action="/predict" method="post" id="prediction-form">
      <div class="input-group">
        <label for="age">Age:</label>
        <div class="input-description">Enter your age in years</div>
        <input type="number" name="age" required placeholder="Eg: 25" />
      </div>

      <div class="input-group">
        <label for="sex">Sex:</label>
        <select name="sex" class="input-select" required>
          <option value="0">Female</option>
          <option value="1">Male</option>
        </select>
      </div>

      <div class="input-group">
        <label for="cp">Chest Pain Type:</label>
        <select name="cp" class="input-select" required>
          <option value="0">Typical Angina</option>
          <option value="1">Atypical Angina</option>
          <option value="2">Non-Anginal Pain</option>
          <option value="3">Asymptomatic</option>
        </select>
      </div>

      <div class="input-group">
        <label for="trestbps">Resting Blood Pressure:</label>
        <div class="input-description">
          Enter resting blood pressure in mmHg
        </div>
        <input
          type="number"
          name="trestbps"
          required
          placeholder="normal range: 90-140"
        />
      </div>

      <div class="input-group">
        <label for="chol">Cholesterol:</label>
        <div class="input-description">Enter serum cholesterol in mg/dl</div>
        <input
          type="number"
          name="chol"
          required
          placeholder="normal range: 120-240"
        />
      </div>

      <div class="input-group">
        <label for="fbs">Fasting Blood Sugar:</label>
        <select name="fbs" class="input-select" required>
          <option value="0">â‰¤ 120 mg/dl</option>
          <option value="1">> 120 mg/dl</option>
        </select>
      </div>

      <div class="input-group">
        <label for="restecg">Resting ECG Results:</label>
        <select name="restecg" class="input-select" required>
          <option value="0">Normal</option>
          <option value="1">ST-T Wave Abnormality</option>
          <option value="2">Left Ventricular Hypertrophy</option>
        </select>
      </div>

      <div class="input-group">
        <label for="thalach">Maximum Heart Rate:</label>
        <div class="input-description">Enter maximum heart rate</div>
        <input
          type="number"
          name="thalach"
          required
          placeholder="normal range: 60-100"
          title="Highest heart rate achieved during exercise."
        />
      </div>

      <div class="input-group">
        <label for="exang">Exercise Induced Angina:</label>
        <select name="exang" class="input-select" required>
          <option value="0">No</option>
          <option value="1">Yes</option>
        </select>
      </div>

      <div class="input-group">
        <label for="oldpeak">ST Depression:</label>
        <div class="input-description">
          Enter ST depression induced by exercise relative to rest
        </div>
        <input
          type="number"
          step="0.1"
          name="oldpeak"
          required
          placeholder="normal range: 0.0-6.0"
          title="ST depression in ECG caused by exercise (higher values indicate more severe heart stress)"
        />
      </div>

      <div class="input-group">
        <label for="slope">Slope of Peak Exercise ST Segment:</label>
        <select
          name="slope"
          class="input-select"
          required
          title="
        Upsloping: normal response to exercise
        Flat : abnormal, could indicate heart disease
        Downsloping : strongly abnormal"
        >
          <option value="0">Upsloping</option>
          <option value="1">Flat</option>
          <option value="2">Downsloping</option>
        </select>
      </div>

      <div class="input-group">
        <label for="ca">Number of Major Vessels:</label>
        <select
          name="ca"
          class="input-select"
          required
          title="Number of major blood vessels visible in fluoroscopy. Higher values indicate more severe blockage."
        >
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>
      </div>

      <div class="input-group">
        <label for="thal">Thalassemia:</label>
        <select name="thal" class="input-select" required>
          <option value="0">Normal</option>
          <option value="1">Fixed Defect</option>
          <option value="2">Reversible Defect</option>
          <option value="3">Not Available</option>
        </select>
      </div>

      <button type="submit">Predict</button>
    </form>

    {% if result %}
    <div id="prediction-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Prediction Results</h2>
        <p><strong>Primary Assessment:</strong> {{ result.prediction }}</p>
        <p><strong>Risk Probability:</strong> {{ result.probability }}%</p>
        <p><strong>Risk Category:</strong> {{ result.risk_category }}</p>

        <div class="risk-meter">
          <div
            class="risk-indicator"
            style="left: {{ result.probability }}%"
          ></div>
        </div>

        <div class="recommendations">
          <h3>Recommendations:</h3>
          <ul>
            {% for recommendation in result.recommendations %}
            <li>{{ recommendation }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var modal = document.getElementById("prediction-modal");
        var closeBtn = document.querySelector(".close-btn");
        modal.style.display = "block"; // Show the modal when result exists
        if (modal) {
          document.getElementById("prediction-form").blur;
        }
        closeBtn.addEventListener("click", function () {
          modal.style.display = "none";
        });

        window.addEventListener("click", function (event) {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        });
      });
    </script>
    {% endif %} {% if error %}
    <div class="error">{{ error }}</div>
    {% endif %}
  </body>
</html>
